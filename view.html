<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™‚ç©ºå›è·¯ - æ·±åº¦å›é¡§</title>
    <style>
        /* --- åˆ†æ°´å¶º 4: å¤§æ°£å¤–è§€ (CSS) --- */
        body { background-color: #f5f5f7; font-family: -apple-system, sans-serif; margin: 0; color: #1d1d1f; }
        .container { max-width: 500px; margin: 0 auto; padding: 40px 25px; }
        
        /* å¤§æ°£æ¨™é¡Œ */
        .header { display: flex; align-items: center; margin-bottom: 40px; cursor: pointer; }
        .header h1 { font-size: 34px; font-weight: 800; letter-spacing: -1px; margin: 0; }
        .back-arrow { font-size: 24px; color: #0071e3; margin-right: 10px; font-weight: 800; }

        /* æ™‚å…‰å¡ç‰‡ */
        .timeline { position: relative; border-left: 2px solid #d2d2d7; margin-left: 10px; padding-left: 30px; }
        .log-card { 
            background: #ffffff; border-radius: 20px; padding: 20px; margin-bottom: 25px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative;
        }
        /* æ™‚é–“é»é» */
        .log-card::before {
            content: ""; position: absolute; left: -41px; top: 25px;
            width: 16px; height: 16px; background: #0071e3; border-radius: 50%; border: 4px solid #f5f5f7;
        }

        .log-time { font-size: 13px; color: #86868b; font-weight: 600; margin-bottom: 8px; text-transform: uppercase; }
        .log-action { font-size: 22px; font-weight: 700; color: #1d1d1f; margin-bottom: 10px; }
        .log-location { font-size: 14px; color: #0071e3; font-weight: 500; display: flex; align-items: center; }
        
        /* åˆ†é¡æ¨™ç±¤é¡è‰² */
        .tag-work { border-left: 5px solid #0071e3; }
        .tag-rest { border-left: 5px solid #34c759; }
        .tag-emotion { border-left: 5px solid #ff3b30; }
    </style>
</head>
<body>

<div class="container">
    <div class="header" onclick="location.href='index.html'">
        <span class="back-arrow">ã€ˆ</span>
        <h1>æ™‚å…‰æµ</h1>
    </div>

    <div class="timeline" id="logTimeline">
        <p style="color: #86868b;">æ­£åœ¨å¾é›²ç«¯è®€å–ä½ çš„å›è·¯...</p>
    </div>
</div>

<script type="module">
    /* --- åˆ†æ°´å¶º 2: é›²ç«¯é‘°åŒ™ (èˆ‡ index.html ç›¸åŒ) --- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAt3NMGtToRrMbau8kIYyOybgIv",
        authDomain: "now-doing.firebaseapp.com",
        projectId: "now-doing",
        storageBucket: "now-doing.firebasestorage.app",
        messagingSenderId: "234295652644",
        appId: "1:234295652644:web:c9b3c37de32d94"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* --- åˆ†æ°´å¶º 1: æ•¸æ“šç¥ç¶“ (æ™‚å…‰æµé‚è¼¯) --- */
    async function loadLogs() {
        const timeline = document.getElementById('logTimeline');
        const q = query(collection(db, "daily_logs"), orderBy("timestamp", "desc"), limit(50));
        
        try {
            const querySnapshot = await getDocs(q);
            timeline.innerHTML = '';
            
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const time = data.timestamp ? data.timestamp.toDate().toLocaleString('zh-TW', { hour12: false }) : 'å‰›æ‰';
                const loc = data.location ? `ğŸ“ ${data.location.lat.toFixed(3)}, ${data.location.lon.toFixed(3)}` : 'ğŸ“ æœªçŸ¥åº§æ¨™';
                
                const card = document.createElement('div');
                card.className = 'log-card';
                card.innerHTML = `
                    <div class="log-time">${time}</div>
                    <div class="log-action">${data.action}</div>
                    <div class="log-location">${loc}</div>
                `;
                timeline.appendChild(card);
            });
        } catch (e) {
            timeline.innerHTML = '<p>è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®šã€‚</p>';
        }
    }

    loadLogs();
</script>
</body>
</html>
