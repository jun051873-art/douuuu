<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê≠§ÊôÇÊ≠§Âàª</title>
    <style>
        body { background-color: #ffffff; font-family: -apple-system, sans-serif; margin: 0; display: flex; justify-content: center; }
        .zen-container { max-width: 400px; width: 100%; margin: 80px 30px; text-align: left; }
        .ios-title { font-size: 34px; font-weight: 700; letter-spacing: -1px; margin-bottom: 40px; color: #1d1d1f; }
        .pill-group { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 60px; }
        .pill { 
            background: #f5f5f7; border: none; padding: 12px 24px; border-radius: 25px;
            font-size: 17px; font-weight: 500; color: #1d1d1f; transition: 0.2s;
        }
        .pill:active { transform: scale(0.9); background: #e8e8ed; }
        .input-nexus { display: flex; align-items: center; border-bottom: 1.5px solid #d2d2d7; padding-bottom: 10px; }
        input[type="text"] { flex: 1; border: none; outline: none; font-size: 19px; background: transparent; color: #1d1d1f; }
        .action-circle { 
            width: 32px; height: 32px; background: #1d1d1f; color: white; border: none; 
            border-radius: 50%; font-size: 20px; display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div class="zen-container">
    <h1 class="ios-title">Ê≠§ÊôÇÊ≠§Âàª</h1>
    <div class="pill-group">
        <button class="pill" onclick="saveActivity('üíº Â∑•‰Ωú')">Â∑•‰Ωú</button>
        <button class="pill" onclick="saveActivity('üöΩ Á®çÊÅØ')">Á®çÊÅØ</button>
        <button class="pill" onclick="saveActivity('üåßÔ∏è ÊÉÖÁ∑í')">ÊÉÖÁ∑í</button>
        <button class="pill" onclick="saveActivity('üì± ÈùúÈªò')">ÈùúÈªò</button>
        <button class="pill" onclick="saveActivity('üç± ËÉΩÈáè')">ËÉΩÈáè</button>
    </div>
    <div class="input-nexus">
        <input type="text" id="customInput" placeholder="ÂØ´‰∏ãÊ≠§ÊôÇÁöÑÂÇôË®ª..." />
        <button class="action-circle" onclick="saveWithNote()">Ôºã</button>
    </div>
    <p id="status" style="margin-top:20px; font-size:13px; color:#86868b;"></p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ‰Ω†ÁöÑÂ∞àÂ±¨Èõ≤Á´ØÈë∞Âåô
    const firebaseConfig = {
        apiKey: "AIzaSyAt3NMGtToRrMbau8kIYyOybgIv",
        authDomain: "now-doing.firebaseapp.com",
        projectId: "now-doing",
        storageBucket: "now-doing.firebasestorage.app",
        messagingSenderId: "234295652644",
        appId: "1:234295652644:web:c9b3c37de32d94"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ê†∏ÂøÉÁ•ûÁ∂ìÔºöÂ≠òÊ™îÂãï‰Ωú
    async function saveActivity(actionName) {
        const status = document.getElementById('status');
        status.innerText = "Ê≠£Âú®ÊÑüÁü•‰ΩçÁΩÆËàáÁ¥ÄÈåÑ...";

        // ÈùúÈªòÊäìÂèñ‰ΩçÁΩÆ
        navigator.geolocation.getCurrentPosition(async (pos) => {
            try {
                await addDoc(collection(db, "daily_logs"), {
                    action: actionName,
                    timestamp: serverTimestamp(),
                    location: {
                        lat: pos.coords.latitude,
                        lon: pos.coords.longitude
                    }
                });
                status.innerText = "Â∑≤Â≠òÂÖ•ÊôÇÂÖâÂõûË∑Ø„ÄÇ";
                setTimeout(() => { status.innerText = ""; }, 2000);
            } catch (e) {
                status.innerText = "Á¥ÄÈåÑÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑Ø„ÄÇ";
            }
        }, () => {
            // Â¶ÇÊûúÊ≤íÊäìÂà∞‰ΩçÁΩÆÔºå‰πü‰æùÁÑ∂Â≠ò‰∏ãÂãï‰Ωú
            addDoc(collection(db, "daily_logs"), {
                action: actionName,
                timestamp: serverTimestamp()
            });
            status.innerText = "Â∑≤Â≠òÂÖ•ÔºàÁÑ°Â∫ßÊ®ôÔºâ„ÄÇ";
        });
    }

    // Ëá™ÂÆöÁæ©Ëº∏ÂÖ•Á•ûÁ∂ì
    window.saveWithNote = () => {
        const input = document.getElementById('customInput');
        if (input.value) {
            saveActivity(input.value);
            input.value = "";
        }
    };
    window.saveActivity = saveActivity;
</script>

</body>
</html>
