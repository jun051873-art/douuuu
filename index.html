window.loadMemories = async () => {
        const snap = await getDocs(query(collection(db, "daily_logs"), orderBy("timestamp", "desc")));
        const area = document.getElementById('memoryArea'); 
        area.innerHTML = '';
        
        const weeks = ['週日', '週一', '週二', '週三', '週四', '週五', '週六'];
        let lastDateStr = ""; // 用來記錄上一條資料的日期

        snap.forEach(d => {
            const data = d.data();
            if(data.type === 'input') {
                const date = data.timestamp ? data.timestamp.toDate() : new Date();
                
                // 格式化日期：例如 "2月6日 週五"
                const dateStr = `${date.getMonth() + 1}月${date.getDate()}日 ${weeks[date.getDay()]}`;
                const timeStr = `${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;

                // 如果日期變了，就插入一個精美的日期標頭
                if (dateStr !== lastDateStr) {
                    const dateHeader = document.createElement('div');
                    dateHeader.style.cssText = "font-size: 11px; color: #000; font-weight: 700; margin: 20px 0 15px -21.5px; background: #fff; display: inline-block; padding-right: 10px;";
                    dateHeader.innerText = dateStr;
                    area.appendChild(dateHeader);
                    lastDateStr = dateStr;
                }

                const div = document.createElement('div'); 
                div.className = 'memory-item';
                div.innerHTML = `
                    <span class="time-label">${timeStr}</span>
                    <div style="font-size:17px; font-weight:300; color:#1d1d1f; line-height:1.6;">${data.action}</div>
                `;
                area.appendChild(div);
            }
        });
    };
