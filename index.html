<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>現在在幹嘛？ 1號 - 星系鎖定版</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; font-family: -apple-system, sans-serif; overflow: hidden; }
        
        /* 星系容器 */
        .galaxy-stage { width: 100%; height: 55vh; position: relative; display: flex; align-items: center; justify-content: center; }
        .bubble { 
            position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            text-align: center; transition: all 1s cubic-bezier(0.23, 1, 0.32, 1);
            font-size: 13px; font-weight: 500;
        }

        /* 底部細微化文字 */
        .insight-mini { width: 85%; margin-top: 10px; font-size: 13px; color: #8e8e93; line-height: 2; }
        .insight-item { display: flex; justify-content: space-between; border-bottom: 0.5px solid #f2f2f7; padding: 5px 0; }
        .highlight { color: #000; font-weight: 600; }

        /* 回憶刻度尺樣式 */
        .timeline-ruler { width: 85%; margin-top: 40px; overflow-y: auto; height: 60vh; padding-left: 20px; }
        .ruler-mark { position: relative; border-left: 1px solid #d2d2d7; padding-left: 25px; margin-bottom: 30px; }
        
        /* 刻度長度區分 */
        .ruler-mark.day::before { content: ''; position: absolute; left: -1px; top: 0; width: 8px; height: 1px; background: #d2d2d7; }
        .ruler-mark.week::before { content: ''; position: absolute; left: -1px; top: 0; width: 15px; height: 1.5px; background: #8e8e93; }
        .ruler-mark.month::before { content: ''; position: absolute; left: -1px; top: 0; width: 25px; height: 2px; background: #000; }
        
        .log-text { font-size: 17px; font-weight: 400; color: #1d1d1f; }
        .log-time { font-size: 11px; color: #a1a1a6; margin-top: 4px; letter-spacing: 1px; }

        /* 通用滑動與標籤樣式鎖定... */
    </style>
</head>
<body>

<script type="module">
    // ... (Firebase 載入邏輯) ...

    async function drawGalaxy() {
        const snap = await getDocs(query(collection(db, "daily_logs")));
        const counts = {};
        snap.forEach(doc => { const a = doc.data().action; counts[a] = (counts[a] || 0) + 1; });
        
        const sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]);
        const stage = document.getElementById('galaxyStage');
        stage.innerHTML = '';

        sorted.forEach(([name, count], i) => {
            const b = document.createElement('div');
            b.className = 'bubble';
            const isSun = i === 0;
            const size = isSun ? 120 : Math.max(60, 100 - (i * 10));
            
            b.style.width = size + 'px'; b.style.height = size + 'px';
            b.style.background = isSun ? '#000' : `rgba(0,0,0,${0.1 - (i * 0.01)})`;
            b.style.color = isSun ? '#fff' : '#000';
            
            // 星系排版：中心與繞行
            if(isSun) {
                b.style.zIndex = 10;
            } else {
                const angle = (i * (360 / (sorted.length - 1))) * (Math.PI / 180);
                const radius = 130;
                b.style.left = `calc(50% + ${Math.cos(angle) * radius}px - ${size/2}px)`;
                b.style.top = `calc(50% + ${Math.sin(angle) * radius}px - ${size/2}px)`;
            }
            b.innerText = name;
            stage.appendChild(b);
        });
        
        // 更新微型數據
        document.getElementById('insightArea').innerHTML = `
            <div class="insight-item">本月重心 <span class="highlight">${sorted[0] ? sorted[0][0] : '--'}</span></div>
            <div class="insight-item">最溫度的時段 <span class="highlight">14:00 - 16:00</span></div>
            <div class="insight-item">捕捉到的瞬間 <span class="highlight">${snap.size} 則</span></div>
        `;
    }
</script>
</body>
</html>
