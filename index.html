<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>在幹嘛 1 號 - 輕柔約定版</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; font-family: -apple-system, sans-serif; overflow: hidden; -webkit-font-smoothing: antialiased; }
        
        /* 標語層 - 輕柔浮現的靈魂 */
        #splashLayer { position: fixed; top: 15%; width: 100%; text-align: center; z-index: 5000; pointer-events: none; transition: opacity 0.8s ease; }
        #splashLayer h2 { font-size: 15px; font-weight: 200; letter-spacing: 4px; color: #1d1d1f; opacity: 0; transform: translateY(5px); transition: 0.8s; }
        #splashLayer.active h2 { opacity: 0.4; transform: translateY(0); }

        /* 軌道容器 - 極致輕柔滑動 */
        .main-container { width: 100%; height: 500vh; transition: transform 0.8s cubic-bezier(0.15, 1, 0.3, 1); display: flex; flex-direction: column; will-change: transform; }
        .page { width: 100%; height: 100vh; flex-shrink: 0; position: relative; display: flex; flex-direction: column; align-items: center; padding-top: 10vh; box-sizing: border-box; background: #fff; transition: opacity 0.8s; }
        .page.inactive { opacity: 0.3; }

        /* 星系球體 */
        .galaxy-stage { width: 100%; height: 50vh; position: relative; display: flex; align-items: center; justify-content: center; }
        .sphere { position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 1s cubic-bezier(0.2, 1, 0.3, 1); animation: softFloat var(--d) infinite ease-in-out; box-shadow: 0 10px 40px rgba(0,0,0,0.02); }
        @keyframes softFloat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* 回憶尺標與透視解析 */
        .insight-area { width: 80%; margin-top: 25px; font-size: 12px; color: #8e8e93; line-height: 2.8; border-top: 0.5px solid #f2f2f7; padding-top: 15px; }
        .memory-area { width: 85%; margin-top: 20px; overflow-y: auto; height: 55vh; border-left: 1px solid #000; padding-left: 18px; }
        .memory-item::before { content: ''; position: absolute; left: -19px; top: 9px; width: 10px; height: 1px; background: #000; }

        .dots-container { position: fixed; left: 22px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 14px; z-index: 1000; }
        .dot { width: 3px; height: 3px; background: #d2d2d7; border-radius: 50%; transition: 0.4s; }
        .dot.active { background: #000; transform: scale(2.2); }
    </style>
</head>
<body>

<div id="splashLayer" class="active"><h2 id="splashText">：（多久沒問問自己了呢）</h2></div>
<div class="dots-container"><div id="dot0" class="dot active"></div><div id="dot1" class="dot"></div><div id="dot2" class="dot"></div><div id="dot3" class="dot"></div><div id="dot4" class="dot"></div></div>

<div class="main-container" id="mainContainer">
    <section class="page" id="p0"><h1>現在在幹嘛</h1><div id="stage0" class="galaxy-stage"></div></section>
    <section class="page" id="p1"><h1>標籤</h1><div id="stage1" class="galaxy-stage"></div></section>
    <section class="page" id="p2"><h1>透視</h1><div id="stage2" class="galaxy-stage"></div><div id="insightArea" class="insight-area"></div></section>
    <section class="page" id="p3"><h1>回憶</h1><div id="memoryArea" class="memory-area"></div></section>
    <section class="page" id="p4"><h1>標語</h1><div id="quoteEditor" style="width:85%;margin-top:25px"></div></section>
</div>

<script type="module">
    // ... Firebase 初始配置 (保持不變) ...
    let quotes = JSON.parse(localStorage.getItem('myQuotes')) || [":（多久沒問問自己了呢）", "每個都可以是你", "接受不完美的自己", "你值得擁有", "詩人 你也可以"];
    let tags = JSON.parse(localStorage.getItem('myPills')) || [{ name: '☕ 休息', selected: true, count: 0 }];

    window.renderAll = () => {
        const s0 = document.getElementById('stage0'), s1 = document.getElementById('stage1');
        tags.sort((a,b) => (b.count || 0) - (a.count || 0));
        const max = tags[0]?.count || 1;
        s0.innerHTML = ''; s1.innerHTML = '';
        tags.forEach((t, i) => {
            const ratio = t.count / max;
            const style = `width:${60+(ratio*50)}px; height:${60+(ratio*50)}px; background:${i===0?'#000':(ratio>0.5?'#444':'#eee')}; color:${i===0||ratio>0.5?'#fff':'#000'}; --d:${8+i}s;`;
            // 螺旋座標計算...
            // 標籤功能與渲染...
        });
    };

    let startY = 0, cur = 0;
    window.addEventListener('touchstart', e => startY = e.touches[0].clientY);
    window.addEventListener('touchend', e => {
        let dist = startY - e.changedTouches[0].clientY;
        if (Math.abs(dist) > 45) {
            const old = cur; cur = dist > 0 ? Math.min(cur + 1, 4) : Math.max(cur - 1, 0);
            if (old !== cur) {
                const splash = document.getElementById('splashLayer');
                splash.classList.remove('active'); // 輕柔隱藏
                setTimeout(() => {
                    document.getElementById('splashText').innerText = quotes[cur];
                    splash.classList.add('active'); // 輕柔浮現
                }, 400);
                
                document.getElementById('mainContainer').style.transform = `translateY(-${cur * 100}vh)`;
                [0,1,2,3,4].forEach(i => {
                    document.getElementById(`dot${i}`).classList.toggle('active', i === cur);
                    document.getElementById(`p${i}`).classList.toggle('inactive', i !== cur);
                });
                if(cur === 2) loadInsight(); if(cur === 3) loadMemories();
            }
        }
    });

    window.onload = () => { window.renderAll(); };
</script>
</body>
</html>
