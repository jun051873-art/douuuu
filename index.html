<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ¨å¹¹å˜› 1 è™Ÿ - ç‰©ç†æ‹–æ›³ç‰ˆ</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #fff; font-family: -apple-system, sans-serif; overflow: hidden; }
        
        /* æŠ–å‹•å‹•ç•« */
        @keyframes jiggle {
            0% { transform: rotate(-1deg); }
            50% { transform: rotate(1.5deg); }
            100% { transform: rotate(-1deg); }
        }
        .jiggling { animation: jiggle 0.2s infinite !important; box-shadow: 0 15px 40px rgba(0,0,0,0.15) !important; }

        .sphere { 
            position: absolute; border-radius: 50%; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; 
            cursor: grab; transition: transform 0.2s, background 0.5s; z-index: 10;
            user-select: none; -webkit-user-select: none;
        }
        .sphere:active { cursor: grabbing; transform: scale(1.1); }

        .galaxy-stage { width: 100%; height: 60vh; position: relative; margin-top: 20px; }
        .dots-container { position: fixed; left: 20px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 15px; z-index: 1000; }
        .dot { width: 4px; height: 4px; background: #d2d2d7; border-radius: 50%; }
        .dot.active { background: #000; transform: scale(2); }

        .main-container { width: 100%; height: 500vh; transition: transform 0.6s cubic-bezier(0.2, 1, 0.3, 1); }
        .page { width: 100%; height: 100vh; position: relative; display: flex; flex-direction: column; align-items: center; padding-top: 10vh; box-sizing: border-box; }
        .input-section { position: absolute; bottom: 80px; display: flex; align-items: center; border-bottom: 1px solid #eee; padding: 5px; background: #fff; z-index: 100; }
    </style>
</head>
<body>

<div class="dots-container"><div id="dot0" class="dot active"></div><div id="dot1" class="dot"></div><div id="dot2" class="dot"></div><div id="dot3" class="dot"></div><div id="dot4" class="dot"></div></div>

<div class="main-container" id="mainContainer">
    <section class="page" id="p0"><h1>ç¾åœ¨åœ¨å¹¹å˜›</h1><div id="stage0" class="galaxy-stage"></div><div class="input-section"><input type="text" id="userInput" style="border:none;text-align:center;outline:none;font-size:18px" placeholder="æ­¤åˆ»å¿ƒæƒ…..."><button onclick="window.saveAction('input')" style="background:#000;color:#fff;border:none;border-radius:50%;width:35px;height:35px">â†‘</button></div></section>
    <section class="page" id="p1"><h1>æ¨™ç±¤</h1><div id="stage1" class="galaxy-stage"></div></section>
    <section class="page"><h1>é€è¦–</h1></section>
    <section class="page"><h1>å›æ†¶</h1></section>
    <section class="page"><h1>æ¨™èª</h1></section>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyAt3NMGtToRrMbau8kIYyOybgIvH65a8rA", authDomain: "now-doing.firebaseapp.com", projectId: "now-doing", storageBucket: "now-doing.firebasestorage.app", messagingSenderId: "234295652644", appId: "1:234295652644:web:c9b3c37de32d9448d443b1" };
    const db = getFirestore(initializeApp(firebaseConfig));

    let tags = JSON.parse(localStorage.getItem('myPills')) || [{ name: 'â˜• ä¼‘æ¯', selected: true, count: 0, x: 50, y: 50 }, { name: 'ğŸ’‡ å·¥ä½œ', selected: true, count: 0, x: 30, y: 30 }];
    let isEditing = false;

    function getSphereColor(ratio) {
        if (ratio > 0.8) return '#000'; // ç´”é»‘
        if (ratio > 0.5) return '#555'; // æ·±ç°
        if (ratio > 0.3) return '#888'; // ä¸­ç°
        return '#ccc'; // æ·ºç°
    }

    function render() {
        const stages = [document.getElementById('stage0'), document.getElementById('stage1')];
        stages.forEach((st, idx) => {
            if(!st) return;
            st.innerHTML = '';
            const max = Math.max(...tags.map(t => t.count)) || 1;
            
            tags.forEach((t, i) => {
                if(idx === 0 && !t.selected) return;
                
                const ratio = t.count / max;
                const s = document.createElement('div');
                s.className = 'sphere' + (isEditing ? ' jiggling' : '');
                const size = 70 + (ratio * 60);
                
                s.style.width = size+'px'; s.style.height = size+'px';
                s.style.left = (t.x || 50) + '%'; s.style.top = (t.y || 50) + '%';
                s.style.background = getSphereColor(ratio);
                s.style.color = ratio > 0.3 ? '#fff' : '#000';
                s.innerHTML = `<span style="font-size:14px">${t.name}</span>`;

                // æ‹–æ›³é‚è¼¯
                let startX, startY, origX, origY;
                const startMove = (e) => {
                    if(!isEditing) return;
                    const touch = e.touches ? e.touches[0] : e;
                    startX = touch.clientX; startY = touch.clientY;
                    origX = t.x; origY = t.y;
                    document.onmousemove = document.ontouchmove = move;
                    document.onmouseup = document.ontouchend = stop;
                };
                const move = (e) => {
                    const touch = e.touches ? e.touches[0] : e;
                    t.x = origX + (touch.clientX - startX) / window.innerWidth * 100;
                    t.y = origY + (touch.clientY - startY) / window.innerHeight * 100;
                    s.style.left = t.x + '%'; s.style.top = t.y + '%';
                };
                const stop = () => { document.onmousemove = document.ontouchmove = null; localStorage.setItem('myPills', JSON.stringify(tags)); };

                // é•·æŒ‰é€²å…¥ç·¨è¼¯
                let pressTimer;
                s.onmousedown = s.ontouchstart = (e) => {
                    pressTimer = setTimeout(() => { isEditing = true; render(); }, 1500);
                    startMove(e);
                };
                s.onmouseup = s.ontouchend = () => {
                    clearTimeout(pressTimer);
                    if(!isEditing && idx === 0) { t.count++; window.saveAction('tag', t.name); render(); }
                };

                st.appendChild(s);
            });
        });
    }

    window.saveAction = async (type, val) => { /* Firebase å„²å­˜é‚è¼¯ */ };
    window.addEventListener('click', (e) => { if(e.target.tagName === 'SECTION') { isEditing = false; render(); } });
    render();
</script>
</body>
</html>
