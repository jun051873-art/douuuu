<style>
    /* 星系氣泡的呼吸美學 */
    .bubble { 
        position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
        text-align: center; transition: background 1s ease; font-size: 13px; font-weight: 500;
        will-change: transform; /* 優化 iPhone 上的流暢度 */
    }

    /* 每個星系獨立的隨機漂浮動畫 */
    @keyframes cosmicDrift {
        0% { transform: translate(0, 0); }
        33% { transform: translate(4px, -6px); }
        66% { transform: translate(-3px, 5px); }
        100% { transform: translate(0, 0); }
    }
</style>

<script type="module">
    // ... 前段 Firebase 邏輯維持鎖定 ...

    window.loadGalaxy = async () => {
        const snap = await getDocs(query(collection(db, "daily_logs")));
        const counts = {};
        snap.forEach(doc => { const a = doc.data().action; counts[a] = (counts[a] || 0) + 1; });
        
        const sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]);
        const stage = document.getElementById('galaxyStage');
        stage.innerHTML = '';

        sorted.forEach(([name, count], i) => {
            const b = document.createElement('div');
            b.className = 'bubble';
            const isSun = i === 0;
            const size = isSun ? 120 : Math.max(65, 105 - (i * 12));
            
            b.style.width = size + 'px'; b.style.height = size + 'px';
            b.style.background = isSun ? '#000' : `rgba(0,0,0,${0.08 - (i * 0.01)})`;
            b.style.color = isSun ? '#fff' : '#000';
            
            // 賦予隨機的動畫節奏 (讓漂浮不重疊、不規律)
            const duration = 5 + Math.random() * 5; // 5-10秒不等
            const delay = Math.random() * -5;
            b.style.animation = `cosmicDrift ${duration}s infinite ease-in-out ${delay}s`;

            if(isSun) {
                b.style.zIndex = 10;
                b.style.left = '50%'; b.style.top = '50%';
                b.style.marginLeft = `-${size/2}px`; b.style.marginTop = `-${size/2}px`;
            } else {
                // 加入位置的不規則偏移量
                const randomOffset = (Math.random() - 0.5) * 40; 
                const angle = (i * (360 / (sorted.length - 1)) + randomOffset) * (Math.PI / 180);
                const radius = 135;
                b.style.left = `calc(50% + ${Math.cos(angle) * radius}px - ${size/2}px)`;
                b.style.top = `calc(50% + ${Math.sin(angle) * radius}px - ${size/2}px)`;
            }
            b.innerText = name;
            stage.appendChild(b);
        });
        
        // 文字微縮排版：縮小並讓位給星系
        document.getElementById('insightArea').innerHTML = sorted[0] ? `
            <div class="insight-item">本月重心 <span style="color:#000;font-weight:600">${sorted[0][0]}</span></div>
            <div class="insight-item">瞬間邂逅 <span style="color:#000;font-weight:600">${snap.size} 次</span></div>
        ` : '';
    }
</script>
